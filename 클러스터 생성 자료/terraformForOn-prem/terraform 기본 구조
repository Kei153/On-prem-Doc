ì—¬ëŸ¬ ë°©ë²• ì¤‘ ë‚´ê°€ ì„ íƒí•œ ë°©ë²•ì€ ë””ë ‰í† ë¦¬ ë³„ë¡œ ì‘ì—…ì„ ë‚˜ëˆ„ëŠ” êµ¬ì¡°ì´ë‹¤. (ëª¨ë“ˆí™” ì‘ì—…)
ê·¸ í›„ ì—¬ëŸ¬ ì‘ì—…ìœ¼ë¡œ ì¡°ì¸í•  ê²½ìš°ì—” ìƒìœ„ í†µí•© ë””ë ‰í„°ë¦¬ ìƒì„± + moduleë¡œ include ë°©ë²•ìœ¼ë¡œ ê¸°ë³¸ êµ¬ì„±ì„ í•˜ì˜€ë‹¤.

-- ê¸°ë³¸ êµ¬ì¡° --

terraform/
â”œâ”€â”€ app/ # ì—¬ëŸ¬ ì¡°í•©ì„ ì‹¤í–‰í•˜ëŠ” ë””ë ‰í† ë¦¬
â”‚   â””â”€â”€ main.tf # ì´ê³³ì—ì„œ deployment + service ë¥¼ í˜¸ì¶œ
â”‚   â””â”€â”€ outputs.tf
â”‚   â””â”€â”€ terraform.tfvars
â”‚   â””â”€â”€ variables.tf
â”œâ”€â”€ deployment/ # ëª¨ë“ˆí™” (app ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰í•˜ê³  ë³€ìˆ˜ê°’ì„ ì£¼ê¸°ì— ëª¨ë“ˆë¡œ ì“¸ ë””ë ‰í† ë¦¬ì—ëŠ” tfvarsíŒŒì¼ì´ í•„ìš” ì—†ë‹¤)
â”‚   â””â”€â”€ main.tf
â”‚   â””â”€â”€ outputs.tf
â”‚   â””â”€â”€ variables.tf
â”œâ”€â”€ service/ # ëª¨ë“ˆí™” (app ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰í•˜ê³  ë³€ìˆ˜ê°’ì„ ì£¼ê¸°ì— ëª¨ë“ˆë¡œ ì“¸ ë””ë ‰í† ë¦¬ì—ëŠ” tfvarsíŒŒì¼ì´ í•„ìš” ì—†ë‹¤)
â”‚   â””â”€â”€ main.tf
â”‚   â””â”€â”€ outputs.tf
â”‚   â””â”€â”€ variables.tf

...

module "deployment" {
  source = "../deployment"
}

module "service" {
  source = "../service"
}

- ì‹¤í–‰

cd terraform/app
terraform init
terraform apply

----------------------------------------------------------------------------------------------

variables.tf íŒŒì¼ì— ë³€ìˆ˜ ì„¤ì • ì‹œì— ê²€ì¦ ê³¼ì •(validation)ì„ ì¶”ê°€í•˜ë©´ ìœ íš¨ì„± ê²€ì‚¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

(ex)
variable "location" {
  description = "The Azure region to deploy resources"
  type        = string
  ğŸ’¡validation {
    condition = contains(["koreacentral", "westeurope"], var.location)
    error_message = "The location must be koreacentral or westeurope."
  }
}

------------------------------------------------------------------------------------------

variables.tf íŒŒì¼ì— ë¯¼ê° ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤. ì´ ì„¤ì •ìœ¼ë¡œ terraform ì‹¤í–‰ì‹œ outputìœ¼ë¡œ plaintextê°€ ì•„ë‹ˆë¼, 
(sensitive) ë¡œ ì¶œë ¥ì´ ëœë‹¤. 

(ex)
variable "location" {
  description = "The Azure region to deploy resources"
  type        = string
  ğŸ’¡sensitive = true
}

----------------------------------------------------------------

ë¯¼ê° ë³€ìˆ˜ëŠ” CI/CD ê¹Œì§€ ê³ ë ¤í•˜ë©´ í™˜ê²½ë³€ìˆ˜ ì‚¬ìš© ë°©ë²•ì´ ê°€ì¥ ì¶”ì²œ ëœë‹¤.

(ex)
# TF_VAR_ ì ‘ë‘ì‚¬ ì‚¬ìš© â—ï¸ì ‘ë‘ì‚¬ ì‹œì‘ ì¤‘ìš”í•¨!
export TF_VAR_database_password="super_secret_password"
export TF_VAR_api_key="sk-1234567890abcdef"
ğŸ’¡terraform plan ëª…ë ¹ ì „ì— ì„¤ì •í•´ì•¼ í•œë‹¤.

(ex2) -ğŸ’¡ ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€, ê°€ì¥ ì•ˆì „
-- íŒŒì¼ëª… set-terraform-vars.sh ì´ë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ë©´
#!/bin/bash

# CI/CDì—ì„œ ë³´ì•ˆ ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì˜¤ê¸° (ì  í‚¨ìŠ¤ì—ì„œ pipelineì— ì„¤ì • ê°’ìœ¼ë¡œ ë°›ëŠ” ë‹¤ë˜ì§€...)
export TF_VAR_database_password="${VAULT_DB_PASSWORD}"
export TF_VAR_api_key="${VAULT_API_KEY}"

# Terraform ì‹¤í–‰
terraform plan


------------------------------------------------------------------------

Â yaml íŒŒì¼ ì‚¬ìš©í•´ì„œ í…Œë¼í¼ êµ¬ì„±í•´ë³´ê¸°


